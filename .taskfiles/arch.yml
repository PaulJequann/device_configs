version: '3'

tasks:
  setup:
    desc: Arch Linux system setup
    cmds:
      - task: yay
      - task: packages
      - task: docker
      - echo "âœ“ Arch Linux setup complete!"

  packages:
    desc: Install core CLI tools via pacman and yay
    cmds:
      - |
        echo "ðŸ“¦ Installing Arch CLI tools via pacman..."
        sudo pacman -S --needed --noconfirm git stow zsh neovim tmux fzf ripgrep fd bat eza zoxide gemini-cli go-task
      - |
        echo "ðŸ“¦ Installing Arch AUR tools via yay..."
        if command -v yay &> /dev/null; then
          yay -S --needed --noconfirm bun-bin
        else
          echo "âš ï¸ yay not installed, skipping AUR tools. Run 'task arch:yay' first."
        fi

  docker:
    desc: Configure Docker service
    cmds:
      - |
        echo "ðŸ³ Configuring Docker service..."
        if command -v docker &> /dev/null; then
          sudo systemctl enable docker 2>/dev/null || true
          sudo systemctl start docker 2>/dev/null || true
          sudo usermod -aG docker $USER 2>/dev/null || true
          echo "âœ“ Docker service configured"
          echo "Note: Log out and back in for Docker group membership to take effect"
        else
          echo "Docker not installed yet. Install via Homebrew: brew install docker"
        fi

  yay:
    desc: Install yay (AUR helper)
    cmds:
      - |
        if ! command -v yay &> /dev/null; then
          echo "Installing yay (AUR helper)..."
          cd /tmp
          git clone https://aur.archlinux.org/yay.git 2>/dev/null || true
          cd yay
          makepkg -si --noconfirm
          cd ~
          echo "âœ“ yay installed"
        else
          echo "âœ“ yay already installed"
        fi

  gui:
    desc: Install GUI applications via pacman and AUR
    cmds:
      - |
        echo "ðŸ“¦ Installing GUI applications via pacman..."
        sudo pacman -S --needed --noconfirm alacritty discord ollama 2>/dev/null || true
      - |
        echo "ðŸ“¦ Installing GUI applications via AUR..."
        if command -v yay &> /dev/null; then
          yay -S --needed --noconfirm google-chrome microsoft-edge-stable-bin cursor-bin visual-studio-code-bin bruno-bin 2>/dev/null || true
        else
          echo "yay not installed. Run 'task arch:yay' first"
        fi

  update:
    desc: Update all packages (pacman + AUR + optional Homebrew)
    cmds:
      - |
        echo "Updating Arch packages (pacman)..."
        sudo pacman -Syu --noconfirm
      - |
        if command -v yay &> /dev/null; then
          echo "Updating AUR packages..."
          yay -Syu --noconfirm
        fi
      - |
        if command -v brew &> /dev/null; then
          echo "Updating Homebrew packages..."
          brew update && brew upgrade && brew cleanup
        fi

  clean:
    desc: Clean package caches
    cmds:
      - |
        echo "Cleaning pacman cache..."
        sudo pacman -Sc --noconfirm
      - |
        if command -v yay &> /dev/null; then
          echo "Cleaning AUR cache..."
          yay -Sc --noconfirm
        fi
      - |
        if command -v brew &> /dev/null; then
          echo "Cleaning Homebrew cache..."
          brew cleanup -s
          rm -rf $(brew --cache)
        fi
