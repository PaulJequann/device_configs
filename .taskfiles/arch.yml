version: '3'

tasks:
  setup:
    desc: Arch Linux system setup
    cmds:
      - task: install-homebrew
      - task: docker
      - task: yay
      - echo "âœ“ Arch Linux setup complete!"

  install-homebrew:
    desc: Install Homebrew if not present
    cmds:
      - |
        if ! command -v brew &> /dev/null; then
          echo "Installing Homebrew..."
          /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
          eval "$(/home/linuxbrew/.linuxbrew/bin/brew shellenv)"
        else
          echo "âœ“ Homebrew already installed ($(brew --version | head -n1))"
        fi

  docker:
    desc: Configure Docker service
    cmds:
      - |
        echo "ðŸ³ Configuring Docker service..."
        if command -v docker &> /dev/null; then
          sudo systemctl enable docker 2>/dev/null || true
          sudo systemctl start docker 2>/dev/null || true
          sudo usermod -aG docker $USER 2>/dev/null || true
          echo "âœ“ Docker service configured"
          echo "Note: Log out and back in for Docker group membership to take effect"
        else
          echo "Docker not installed yet. Install via Homebrew: brew install docker"
        fi

  yay:
    desc: Install yay (AUR helper)
    cmds:
      - |
        if ! command -v yay &> /dev/null; then
          echo "Installing yay (AUR helper)..."
          cd /tmp
          git clone https://aur.archlinux.org/yay.git 2>/dev/null || true
          cd yay
          makepkg -si --noconfirm
          cd ~
          echo "âœ“ yay installed"
        else
          echo "âœ“ yay already installed"
        fi

  gui:
    desc: Install GUI applications via AUR
    cmds:
      - |
        echo "ðŸ“¦ Installing GUI applications..."
        if command -v yay &> /dev/null; then
          # AUR packages
          yay -S --needed --noconfirm google-chrome microsoft-edge-stable-bin cursor-bin visual-studio-code-bin 2>/dev/null || true
        else
          echo "yay not installed. Run 'task arch:yay' first"
        fi
      - |
        # Homebrew casks for Arch
        brew install --cask alacritty discord ollama bruno 2>/dev/null || true

  update:
    desc: Update all packages (Homebrew + AUR)
    cmds:
      - |
        echo "Updating Homebrew packages..."
        brew update && brew upgrade && brew cleanup
      - |
        if command -v yay &> /dev/null; then
          echo "Updating AUR packages..."
          yay -Syu --noconfirm
        fi

  clean:
    desc: Clean package caches
    cmds:
      - |
        echo "Cleaning Homebrew cache..."
        brew cleanup -s
        rm -rf $(brew --cache)
      - |
        if command -v yay &> /dev/null; then
          echo "Cleaning AUR cache..."
          yay -Sc --noconfirm
        fi
